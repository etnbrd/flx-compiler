<!DOCTYPE html>

<html>
<head>
  <title>CORE DEPENDENCIES RESOLVER</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="core-dependencies-resolver">CORE DEPENDENCIES RESOLVER</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> h = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./helpers'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Javascript is function scoped. Each function enclose a new scope to declare variable in.
A function scope is linked to the scope of its parent : the function inside which the child function is declared.
The child function can access variables in the scope of all its parent, back to the global common scope.
Function scopes are nested like russian dolls.</p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Fluxion scopes, on the other hands, are not nested like functions.
By design, fluxions can’t share variables implicitly like functions.
Instead they exchange data by streams.
There is upstream and downstream fluxions.</p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>A fluxion encapsulate multiple function scope, breaking the original chain of parenting.
This rupture leaves some functions without access to needed variables.
The function <code>detectDependency</code> specify how to resolve the dependencies.</p>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>There is three way to resolve dependencies :</p>
<ul>
<li><strong>signature</strong>
The variable is in the signature of the fluxions.
The upstream fluxion will make sure this variable is sent in the stream.</li>
<li><strong>scope</strong>
The variable is in the scope of one fluxion.
This fluxion can persist modification of this variable, exactly like if it was in a parent scope, or a closure.</li>
<li><strong>sync</strong>
The variable is in the scope of several fluxions.
These fluxions send updates to the others each time the variable is modified.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">detectDependency</span><span class="hljs-params">(dep, flx)</span> </span>{

  <span class="hljs-keyword">var</span> sharing = <span class="hljs-built_in">Object</span>.keys(dep.variable.flxs).length,
      modifiers = <span class="hljs-built_in">Object</span>.keys(dep.variable.modifierFlxs).length;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h3 id="scope">Scope</h3>
<ul>
<li>2 fluxions, none modify the variable : Problem #3</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> ((modifiers === <span class="hljs-number">0</span> &amp;&amp; !h.inSource(dep, flx))</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <ul>
<li>2 fluxions, the root fluxion doesn’t modify the variable : Problem #4</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ||  (modifiers === <span class="hljs-number">1</span> &amp;&amp; h.isSourcePristine(dep) &amp;&amp; !h.inSource(dep, flx))) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"scope"</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h3 id="sync">Sync</h3>
<ul>
<li>more than 2 fluxions, the root fluxion doesn’t modify the variable : Problem #5</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> ((modifiers &gt;= <span class="hljs-number">2</span> &amp;&amp; h.isSourcePristine(dep) &amp;&amp; !h.inSource(dep, flx))) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"sync"</span>;
  }

  <span class="hljs-comment">/*
  if ((sharing &gt; 2 &amp;&amp; h.isSourcePristine(dep) &amp;&amp; h.inSource(dep, flx))) {
    return "signature";
  }
  */</span>

 <span class="hljs-keyword">return</span> <span class="hljs-string">"default"</span>; 
}

<span class="hljs-built_in">module</span>.exports = detectDependency</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
